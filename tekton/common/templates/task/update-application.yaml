apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  annotations:
  name: update-app
spec:
  params:
    - description: Image to update
      name: IMAGE
      type: string
    - description: Name of the application
      name: APP_NAME
      type: string
    - description: Namespace your Argo Instance is located
      name: ARGO_NAMESPACE
      type: string
  steps:
    - image: >-
        image-registry.openshift-image-registry.svc:5000/openshift/cli
      name: oc
      resources: {}
      script: |
        #!/usr/bin/env bash
        oc patch Application/user1-deployment -p  --type merge '{"spec":{"source":{"helm":{"parameters":[{"name":"image","value":"$(params.IMAGE)" },
              {"name":"appName","value":"$(params.APP_NAME)" }]}}}}' -n $(params.ARGO_NAMESPACE)
